version: 2

models:
  - name: arr_data_mart
    description: '{{ doc("arr_data_mart") }}'
    columns:
      - name: arr
        description: "Calculated as 12 * MRR value"
      - name: primary_key
        tests:
            - not_null
            - unique
      - name: reporting_month
        description: "Reporting month. Due to forward looking character of the metric, ARR results are reported as of the end of the previous month. For example, charges with an effective start date on or before 2020-05-01 and an effective_end_date greater than 2020-05-01 would be summed together and that ARR result is what revenue is expected to be generated from 2020-05-01 through 2021-04-01. However, we want to report this number on the 2020-04-01 monthly results so that at the end of April,
        we can report out what is expected to be generated from 2020-05-01 through 2021-04-01. This is accomplished by subtracting 1 month from the mrr_month to derive the reporting_month which allows the result to be reported as of the prior month end."
  - name: arr_data_mart_incr
    description: '{{ doc("arr_data_mart_incr") }}'
    columns:
      - name: primary_key
        tests:
          - not_null
  - name: charges_agg
    description: "Base table used as a starting point for all charge analyses"
    columns:
      - name: charge_id
        tests:
            - not_null
            - unique
      - name: subscription_id
        tests:
            - not_null
      - name: is_last_segment_version
        description: "A rate plan charge can have multiple versions within a charge segment, similar to how a subscription can have multiple versions. The is_last_segment_version flag identifies the last version of a rate plan charge that was invoiced to the customer."
